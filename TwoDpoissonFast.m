N = 16;

% initialized rho_{i,j}
rho_init =[
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   2.50e+01   5.00e+01   5.00e+01   5.00e+01   2.50e+01   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   5.00e+01   1.00e+02   1.00e+02   1.00e+02   5.00e+01   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   5.00e+01   1.00e+02   1.00e+02   1.00e+02   5.00e+01   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   5.00e+01   1.00e+02   1.00e+02   1.00e+02   5.00e+01   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   2.50e+01   5.00e+01   5.00e+01   5.00e+01   2.50e+01   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00   0.00e+00
];

% Setting up S_N
SN = zeros(N-1,N-1);
for i = 1: N-1
    for j = 1: N-1
        SN(i,j) = sin(i*j*pi/N);
    end
end

rho1 = zeros(size(SN));
rho2 = zeros(size(SN));
psi0 = zeros(size(SN));
psi1 = zeros(size(SN));
psi2 = zeros(size(SN));

% Calculating rho^{k,l} -- equation (5.4)
for i = 1: N-1
    rho1(i,:) = (SN*rho_init(i,:)')';
end

for j = 1: N-1
    rho2(:,j) = (SN*rho1(:,j));
end

rho3 = (4/N/N).*rho2;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% Calculating psi^{k,l} -- equation (5.6)
for i = 1: N-1
    for j = 1: N-1
        psi0(i,j) = rho3(i,j)/N/N/(4-2*(cos(i*pi/N)+cos(j*pi/N)));%/(pi*pi*(i^2 + j^2));
    end
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Calculating equation (5.5)
for j = 1: N-1
    psi1(:,j) = (SN*psi0(:,j));
end

for i = 1: N-1
    psi2(i,:) = (SN*psi1(i,:)')';
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

contour(psi2);
colorbar;

